### 事务基本要素
- 原子性
- 一致性
- 持久性
- 隔离性
### 隔离级别
- 读未提交
- 读已提交
- 可重复读 
- 串行化
### 如何减少脏读,幻读
- 添加锁,悲观锁和乐观锁,或redis锁
### Mysql默认隔离级别
- Mysql默认使用可重复读,但实际上互联网项目中使用的是读已提交
- 默认重复读是因为binlog日志复制,主从复制问题,数据会不一致
> 1. 当执行两个client端分别执del和insert sql语句时,binlog Statement 格式导致,修改了读已提交,会锁住,保证顺序
> 2. 修改binlog日志格式为row格式,保证先后顺序   

## Mysql如何写入磁盘中
- 数据库引擎会将数据写入到buff pool 中,由redolog 和 binlog写入磁盘 

## Mysql 索引
- Mysql索引主要有两种结构 Hash索引和B+树,InnoDb 默认b+树
### B+ Tree索引和Hash索引区别？

1. 哈希索引适合等值查询，但是无法进行范围查询 
2. 哈希索引没办法利用索引完成排序 
3. 哈希索引不支持多列联合索引的最左匹配规则 
4. 如果有大量重复键值的情况下，哈希索引的效率会很低，因为存在哈希碰撞问题

### B+ Tree 索引类型
1. 索引B+ Tree的叶子节点存储了整行数据的是主键索引，也被称之为聚簇索引
2. 索引B+ Tree的叶子节点存储了主键的值的是非主键索引，也被称之为非聚簇索引
3. 主键索引查询只会查一次，而非主键索引可能需要回表查询多次,但不一定会查询多次(通过索引覆盖可以查询一次)
4. 索引覆盖:当查询field为联合索引时,就可以通过索引覆盖查询一次: 比如联合索引 idx_key1_key2(key1,key2) select key2 from table where key1 = 'xx'

### 联合索引 最左前缀匹配
1. 当我们创建一个联合索引的时候，如(key1,key2,key3)，相当于创建了（key1）、(key1,key2)和(key1,key2,key3)三个索引，这就是最左匹配原则
### 查询优化器
一条sql查询可以有不同的方式,最终查询优化器会选择执行成本最低的方式
1. 根据搜索条件，找出所有可能使用的索引 
2. 计算全表扫描的代价 
3. 计算使用不同索引执行查询的代价 
4. 对比各种执行方案的代价，找出成本最低的那一个

### 索引种类
1. 普通索引
2. 唯一索引
3. 主键索引
4. 全文索引
### 主键和唯一索引区别
1. 主键是一种约束,唯一索引是一种索引
2. 主键一定包含唯一索引,而唯一索引不一定是主键
3. 唯一索引允许空值,主键不能
4. 主键可以被其他表引用为外键
5. 唯一索引可以多个,主键不能,一个表有多个主键称之为联合主键,也是一个主键

### 执行计划 
- id select查询序列号，id相同，执行顺序由上至下；id不同，id值越大优先级越高，越先被执行；
- select_type : 查询数据的操作类型
  - simple 简单查询不包含子查询和union
  - primary 包含复杂的子查询,最外层查询标记为该值
  - subquery 在select或where 中包含子查询,被标记为该值
  - derived 在from列表中包含的子查询被标记为改值，MySQL会递归这些子查询，将结果保存到临时表；
  - union 第二个select出现在union之后，被标记为该值；union包含在from的子查询中，外层select被标记为derived
  - union result，从union表获取结果的select；
- table 显示该行数据是关于那张表
- partitions 匹配的分区

- type 表的连接类型，其值、性能由高到底排列如下
  - system 表中只有一行记录，相当于系统表
  - const 通过索引一次命中，匹配一行数据
  - eq_ref 唯一性索引扫描，对于每个索引键，表中只有一条记录与之匹配，常用语主键或唯一索引扫描
  - ref 非唯一性索引扫描，返回匹配某个单独值的所有行，用于=、<或>操作符带索引的列
  - range 只检索给定范围的行，使用一个索引来选择行，一般用于between、<、>
  - index 只遍历索引树
  - all 全表扫描
  - 前5种情况都是理想的索引的情况。通常优化至少到range级别，最好能优化到ref
- possible_keys 指出 MySQL 使用哪个索引在该表找到行记录。如果该值为 NULL，说明没有使用索引，可以建立索引提高性能
- key 显示 MySQL 实际使用的索引。如果为 NULL，则没有使用索引查询
- key_len 表示索引中使用的字节数，通过该列计算查询中使用的索引的长度。在不损失精确性的情况下，长度越短越好显示的是索引字段的最大长度，并非实际使用长度
- ref 显示该表的索引字段关联了哪张表的哪个字段
- rows 根据表统计信息及选用情况，大致估算出找到所需的记录或所需读取的行数，数值越小越好
- filtered 返回结果的行数占读取行数的百分比，值越大越好
- extra：包含不适合在其他列中显示但十分重要的额外信息。常见的值如下
  - using filesort，MySQL会对数据使用一个外部索引排序，而不是按照表内索引顺序进行读取，若出现改值，则应优化SQL语句
  - using temporary，使用临时表缓存中间结果，比如，MySQL在对查询结果排序时使用临时表，常见于order by和group by，若出现该值，则应优化SQL
  - using index，表示select操作使用了覆盖索引，避免了访问表的数据行
  - using where，where子句用于限制哪一行
  - using join buffer，使用连接缓存
  - distinct，发现第一个匹配后，停止为当前的行组合搜索更多的行